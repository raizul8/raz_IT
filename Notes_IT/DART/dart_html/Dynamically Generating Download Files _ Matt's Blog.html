<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<title>Dynamically Generating Download Files | Matt&#039;s Blog</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://blog.butlermatt.me/wp-content/themes/twentyten/style.css" />
<link rel="pingback" href="http://blog.butlermatt.me/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Matt&#039;s Blog &raquo; Feed" href="http://blog.butlermatt.me/feed/" />
<link rel="alternate" type="application/rss+xml" title="Matt&#039;s Blog &raquo; Comments Feed" href="http://blog.butlermatt.me/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Matt&#039;s Blog &raquo; Dynamically Generating Download Files Comments Feed" href="http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/feed/" />
<link rel='stylesheet' id='prettify-css'  href='http://blog.butlermatt.me/wp-content/plugins/prettify-code-syntax/stylesheets/bootstrap.css?ver=4.1.2' type='text/css' media='all' />
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.butlermatt.me/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.butlermatt.me/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Going POSTal' href='http://blog.butlermatt.me/2014/01/going-postal/' />
<link rel='next' title='Dart Front and Back' href='http://blog.butlermatt.me/2014/03/dart-front-and-back/' />
<meta name="generator" content="WordPress 4.1.2" />
<link rel='canonical' href='http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/' />
<link rel='shortlink' href='http://blog.butlermatt.me/?p=130' />

<!-- BEGIN GADWP v4.6 Universal Tracking - https://deconf.com/google-analytics-dashboard-wordpress/ -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-45232055-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- END GADWP Universal Tracking -->

</head>

<body class="single single-post postid-130 single-format-standard">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div id="branding" role="banner">
								<div id="site-title">
					<span>
						<a href="http://blog.butlermatt.me/" title="Matt&#039;s Blog" rel="home">Matt&#039;s Blog</a>
					</span>
				</div>
				<div id="site-description">Various Technology Ramblings</div>

										<img src="http://blog.butlermatt.me/wp-content/themes/twentyten/images/headers/path.jpg" width="940" height="198" alt="" />
								</div><!-- #branding -->

			<div id="access" role="navigation">
			  				<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
								<div class="menu"><ul><li ><a href="http://blog.butlermatt.me/">Home</a></li><li class="page_item page-item-152"><a href="http://blog.butlermatt.me/do-not-disturb/">Do Not Disturb</a></li></ul></div>
			</div><!-- #access -->
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="http://blog.butlermatt.me/2014/01/going-postal/" rel="prev"><span class="meta-nav">&larr;</span> Going POSTal</a></div>
					<div class="nav-next"><a href="http://blog.butlermatt.me/2014/03/dart-front-and-back/" rel="next">Dart Front and Back <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-130" class="post-130 post type-post status-publish format-standard hentry category-dart tag-blob tag-data-url tag-download tag-html5">
					<h1 class="entry-title">Dynamically Generating Download Files</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted on</span> <a href="http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/" title="6:11 pm" rel="bookmark"><span class="entry-date">March 12, 2014</span></a> <span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="http://blog.butlermatt.me/author/butlerm/" title="View all posts by Matthew Butler">Matthew Butler</a></span>					</div><!-- .entry-meta -->

					<div class="entry-content">
						<p><img src="http://blog.butlermatt.me/wp-content/uploads/2014/03/DownloadNow.png" alt="Download Now Img" width="600" height="164" class="aligncenter size-full wp-image-129" /></p>
<p>It may come as no surprise to many of you, that I love Dart. With this love, I&#8217;ve made a significant change in the way I handle some of the tasks I get on a day-to-day basis. One of the tasks which would inevitably come up is the take some kind of data or input, handle and manipulate it in some way (internally they like to call it massaging the data, but its rarely that relaxing) and create an output file (usually text).</p>
<p>In the past, normally I would have accomplished this by writing a little Ruby script, or even a Perl script. This often presented a few problems however. First would be that if I wrote the script on my Linux PC, then I&#8217;m the one who had to constantly be emailed the data, or generate it myself. Then e-mail off the results. It also meant that if I wasn&#8217;t in the office, it wasn&#8217;t done. So an option was to my script on a server, then any of the server admins could run the script (once I documented where it was, how to run it, etc). But it still meant that they would have to go through the same process I would need to.</p>
<p><span id="more-130"></span></p>
<p>Of course, the perfect solution is to just create a web-app. Before Dart, I would create a PHP page and script to upload the input information, parse it on the server and provide a download link for the results. It was better, as then at least anyone could run the scripts themselves without needing to go through me or the server admins. But there was one big problem&#8230; it was PHP.</p>
<p>Now with Dart, I don&#8217;t need to go through all of that, and in many cases I only need a server to host the page itself for others to access. No need to transfer the data back and forth to the server for the parsing. One of the major factors in making this easy for me is <a href="http://updates.html5rocks.com/2011/08/Downloading-resources-in-HTML5-a-download">HTML5 Download Attribute</a>.</p>
<p>My first step in dynamically creating a downloadable file is to create a <a href="https://api.dartlang.org/dart_html/Blob">Blob</a> object with the contents of my file. This is really quite simple as the Blob just takes a list of parts which make up the blob, in my case, it&#8217;s usually a list of lines of the final text file. Additional arguments are the MIME encoding for the blob (or rather the final output file, such as &#8220;text/plain&#8221;), and the format of the line endings, which can be either <em>&#8220;transparent&#8221;</em> or <em>&#8220;native&#8221;</em>. Transparent will leave new line endings just as they are passed into the blob, and Native will specify that the file should use the line ending specific to the native operating environment. This means you don&#8217;t have to worry about if your user is on Linux, Mac, or Windows when downloading the file.</p>
<p>Next up, we need to create a <a href="https://developer.mozilla.org/en/docs/data_URIs">Data URI</a> which contains the data from our blob object. Again this is really easy with the Dart <a href="https://api.dartlang.org/dart_html/Url">Url class</a>. In particular using the <a href="https://api.dartlang.org/dart_html/Url.createObjectUrlFromBlob">createObjectUrlFromBlob()</a> method. We just pass in our Blob and receive our URL.</p>
<p>The final step, involves creating our link, and assigning the various properties we need. In the example below I decided to create an entirely new element, however it&#8217;s equally valid to grab a link already in the page and just update its properties and maybe toggle the visibility. In particular we need to set the <a href="https://api.dartlang.org/dart_html/AnchorElement.download">download property</a>. This will be the filename that is automatically used to save the file on the user&#8217;s computer. And we need to set the <a href="https://api.dartlang.org/dart_html/AnchorElement.href">href property</a> to be the Blob URL we just created.</p>
<p>You can see all of this in action below:</p>
<p>test.dart</p>
<pre class="prettyprint linenums"><code class="language-dart">import 'dart:html';

void main() {
  // Our imaginary dynamically generated data
  List body = [ 'This list is the text\n',
                'which our final output\n',
                'file will contain.\n\n',
                "It's really nothing\n",
                'special in any way.\n',
                'Normally this stuff would\n',
                'be dynamically generated\n',
                'in some way.\n\n'];
  
  // Create a new blob from the data.
  Blob blob = new Blob(body, 'text/plain', 'native');
  // Create a data:url which points to that data.
  String url = Url.createObjectUrlFromBlob(blob);
  // Create a link to navigate to that data and download it.
  AnchorElement link = new AnchorElement()
      ..href = url
      ..download = 'random_file.txt'
      ..text = 'Download Now!';
  
  // Insert the link into the DOM.
  var p = querySelector('#text');
  p.append(link);
}
</code></pre>
<p>test.html</p>
<pre class="prettyprint linenums"><code class="language-html">&lt;!DOCTYPE html&gt;

&lt;html&gt;
  &lt;head&gt;
  	&lt;meta charset="utf-8"&gt;
  	&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    
  &lt;/head&gt;
 
  &lt;body&gt;   
    &lt;p id="text"&gt;&lt;/p&gt;
    &lt;script type="application/dart" src="test.dart"&gt;&lt;/script&gt;
    &lt;!-- for this next line to work, your pubspec.yaml file must have a dependency on 'browser' --&gt;
    &lt;script src="packages/browser/dart.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
											</div><!-- .entry-content -->


					<div class="entry-utility">
						This entry was posted in <a href="http://blog.butlermatt.me/category/dart/" rel="category tag">Dart</a> and tagged <a href="http://blog.butlermatt.me/tag/blob/" rel="tag">blob</a>, <a href="http://blog.butlermatt.me/tag/data-url/" rel="tag">data url</a>, <a href="http://blog.butlermatt.me/tag/download/" rel="tag">download</a>, <a href="http://blog.butlermatt.me/tag/html5/" rel="tag">HTML5</a>. Bookmark the <a href="http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/" title="Permalink to Dynamically Generating Download Files" rel="bookmark">permalink</a>.											</div><!-- .entry-utility -->
				</div><!-- #post-## -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://blog.butlermatt.me/2014/01/going-postal/" rel="prev"><span class="meta-nav">&larr;</span> Going POSTal</a></div>
					<div class="nav-next"><a href="http://blog.butlermatt.me/2014/03/dart-front-and-back/" rel="next">Dart Front and Back <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				

<!-- *******************************************************************************************************************-->
<!-- Comments Evolved for Wordpress v1.6 ( http://wordpress.org/plugins/gplus-comments/ ) -->
<!-- *******************************************************************************************************************-->

<!-- comment-tabs -->
<script type="text/javascript">
jQuery(document).ready(function($) {
  window.comment_tab_width = $('#comment-tabs').innerWidth();
});
</script>
<div id="comment-tabs">
<a name="comments"></a>
  <h4 id='comment-tabs-label'>Have Something To Add?</h4>  <ul class="controls inline clearfix">
    <li class="active" id='gplus-control'><a href='#gplus-tab'><img id='gplus-icon' src='http://blog.butlermatt.me/wp-content/plugins/gplus-comments/assets/images/icons/default/gplus.png'><span id='gplus-label'>Google+</span></a></li>
<li id='facebook-control'><a href='#facebook-tab'><img id='facebook-icon' src='http://blog.butlermatt.me/wp-content/plugins/gplus-comments/assets/images/icons/default/facebook.png'><span id='facebook-label'>Facebook</span></a></li>
<li id='disqus-control'><a href='#disqus-tab'><img id='disqus-icon' src='http://blog.butlermatt.me/wp-content/plugins/gplus-comments/assets/images/icons/default/disqus.png'><span id='disqus-label'>Disqus</span></a></li>
  </ul>
  <!-- gplus-tab -->
<div id='gplus-tab' class='embed-container content-tab clearfix'>
<script type="text/javascript">
  jQuery(document).ready(function($) {
    $('#gplus-tab').html('<div class="g-comments" data-width="'+window.comment_tab_width+'" data-href="http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD">Loading Google+ Comments ...</div>');
  });
</script>
<script async type="text/javascript" src="//apis.google.com/js/plusone.js?callback=gpcb"></script>
<noscript>Please enable JavaScript to view the <a href="https://plus.google.com/">comments powered by Google+.</a></noscript>

</div>
<!-- //gplus-tab -->
<!-- facebook-tab -->
<div id='facebook-tab' class='embed-container content-tab clearfix'>
<div id="fb-root"></div>
<div id="fb-comments">Loading Facebook Comments ...</div>
<script type="text/javascript">
  jQuery(document).ready(function($)
  {
    $('#fb-comments').html('<div class="fb-comments" data-width="'+window.comment_tab_width+'" data-href="http://blog.butlermatt.me/2014/03/dynamically-generating-download-files/" data-num-posts="20" data-colorscheme="light" data-mobile="auto"></div>');
  });
</script>
<script async type="text/javascript" src="//connect.facebook.net/en_US/all.js#xfbml=1">FB.init();</script>
<noscript>Please enable JavaScript to view the <a href="https://www.facebook.com/">comments powered by Facebook.</a></noscript>


</div>
<!-- //facebook-tab -->
<!-- disqus-tab -->
<div id='disqus-tab' class='embed-container content-tab clearfix'>
<div class="embed-container clearfix" id="disqus_thread">Loading Disqus Comments ...</div>
<script type="text/javascript">
  var disqus_shortname = 'butlermatt';
  (function(d) {
    var dsq = d.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (d.getElementsByTagName('head')[0] || d.getElementsByTagName('body')[0]).appendChild(dsq);
  })(document);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
<!-- //disqus-tab -->
</div>
<!-- //comment-tabs -->


			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
			<ul class="xoxo">

<li id="search-2" class="widget-container widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://blog.butlermatt.me/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
					<li>
				<a href="http://blog.butlermatt.me/2014/10/marcato-hackathon/">Marcato Hackathon</a>
						</li>
					<li>
				<a href="http://blog.butlermatt.me/2014/09/dart-docker-and-determination/">Dart, Docker, and Determination</a>
						</li>
					<li>
				<a href="http://blog.butlermatt.me/2014/08/polymer-expressions-filtering/">Polymer Expressions &#8211; Filtering</a>
						</li>
					<li>
				<a href="http://blog.butlermatt.me/2014/08/side-effects-may-include-being-wrong/">Side Effects may include&#8230; being wrong!</a>
						</li>
					<li>
				<a href="http://blog.butlermatt.me/2014/08/side-effects/">Side Effects</a>
						</li>
				</ul>
		</li><li id="recent-comments-2" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.butlermatt.me/2014/08/side-effects/' rel='external nofollow' class='url'>Side Effects | Matt&#039;s Blog</a></span> on <a href="http://blog.butlermatt.me/2014/08/side-effects-may-include-being-wrong/#comment-616">Side Effects may include&#8230; being wrong!</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.butlermatt.me/2014/08/side-effects-may-include-being-wrong/' rel='external nofollow' class='url'>Side Effects may include&#8230; being wrong! | Matt&#039;s Blog</a></span> on <a href="http://blog.butlermatt.me/2014/08/side-effects/#comment-615">Side Effects</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.butlermatt.me/?p=35' rel='external nofollow' class='url'>Polymer Plunge: Diving In | Matt&#039;s Blog</a></span> on <a href="http://blog.butlermatt.me/2013/10/new-dart-and-polymer-update-0-8-5-1_r28990/#comment-129">New Dart (and Polymer) Update (0.8.5.1_r28990)</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.butlermatt.me/?p=71' rel='external nofollow' class='url'>New Dart (and Polymer) Update (0.8.5.1_r28990) | Matt&#039;s Blog</a></span> on <a href="http://blog.butlermatt.me/2013/10/polymer-and-route/#comment-128">Polymer and Route</a></li><li class="recentcomments"><span class="comment-author-link"><a href='http://blog.butlermatt.me/?p=13' rel='external nofollow' class='url'>Polymer Plunge | Matt&#039;s Blog</a></span> on <a href="http://blog.butlermatt.me/2013/10/polymer-plunge-diving-in/#comment-17">Polymer Plunge: Diving In</a></li></ul></li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
	<li><a href='http://blog.butlermatt.me/2014/10/'>October 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2014/09/'>September 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2014/08/'>August 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2014/04/'>April 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2014/03/'>March 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2014/01/'>January 2014</a></li>
	<li><a href='http://blog.butlermatt.me/2013/12/'>December 2013</a></li>
	<li><a href='http://blog.butlermatt.me/2013/11/'>November 2013</a></li>
	<li><a href='http://blog.butlermatt.me/2013/10/'>October 2013</a></li>
	<li><a href='http://blog.butlermatt.me/2013/08/'>August 2013</a></li>
		</ul>
</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-4"><a href="http://blog.butlermatt.me/category/dart/" title="Dart related posts, be it server-side, client-side, tutorials, walkthroughs or general comments.">Dart</a>
</li>
	<li class="cat-item cat-item-33"><a href="http://blog.butlermatt.me/category/docker/" >Docker</a>
</li>
	<li class="cat-item cat-item-34"><a href="http://blog.butlermatt.me/category/mongo/" >mongo</a>
</li>
	<li class="cat-item cat-item-39"><a href="http://blog.butlermatt.me/category/personal/" >Personal</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.butlermatt.me/category/reviews/" title="Just my experiences and views of using various apps. May be web, Android, or iOS based as I find something worth writing about.">Reviews</a>
</li>
		</ul>
</li>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="site-info">
				<a href="http://blog.butlermatt.me/" title="Matt&#039;s Blog" rel="home">
					Matt&#039;s Blog				</a>
			</div><!-- #site-info -->

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress.</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->

<link rel='stylesheet' id='comments_evolved_tabs_css-css'  href='http://blog.butlermatt.me/wp-content/plugins/gplus-comments/assets/styles/plugin.css?ver=1.6' type='text/css' media='all' />
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/jquery/ui/core.min.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/jquery/ui/widget.min.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/jquery/ui/tabs.min.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-includes/js/comment-reply.min.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-content/plugins/prettify-code-syntax/javascripts/prettify.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-content/plugins/prettify-code-syntax/javascripts/lang-css.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-content/plugins/prettify-code-syntax/javascripts/lang-dart.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://blog.butlermatt.me/wp-content/plugins/prettify-code-syntax/javascripts/load.js?ver=4.1.2'></script>
<!-- Comments Evolved plugin -->
<script>jQuery("#comment-tabs").tabs();</script>
<!-- //Comments Evolved plugin -->
</body>
</html>
